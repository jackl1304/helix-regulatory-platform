{"version":3,"file":"aiService.js","sourceRoot":"","sources":["../../server/services/aiService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from \"../storage\";\nimport type { RegulatoryUpdate } from \"@shared/schema\";\n\ninterface RegulatoryAnalysis {\n  categories: string[];\n  confidence: number;\n  deviceTypes: string[];\n  riskLevel: 'critical' | 'high' | 'medium' | 'low';\n  therapeuticArea: string;\n  complianceRequirements: string[];\n  aiConfidenceScore: number;\n  regulatoryImpact: 'high' | 'medium' | 'low';\n  timelineSensitivity: 'urgent' | 'standard' | 'routine';\n}\n\ninterface MarketTrendAnalysis {\n  emergingTechnologies: string[];\n  riskTrends: Array<{\n    category: string;\n    trend: 'increasing' | 'decreasing' | 'stable';\n    significance: number;\n  }>;\n  regulatoryFocus: string[];\n  predictedChanges: Array<{\n    area: string;\n    probability: number;\n    timeframe: string;\n    impact: 'high' | 'medium' | 'low';\n  }>;\n}\n\nexport class AIService {\n  \n  // Enhanced regulatory content analysis with ML-powered categorization\n  async analyzeRegulatoryContent(content: string): Promise<RegulatoryAnalysis> {\n    try {\n      const normalizedContent = content.toLowerCase();\n      \n      const categories: string[] = [];\n      const deviceTypes: string[] = [];\n      const complianceRequirements: string[] = [];\n      let riskLevel = 'medium';\n      let confidence = 0;\n      let therapeuticArea = 'general';\n\n      // Device type analysis\n      const deviceTypeKeywords = [\n        'diagnostic', 'therapeutic', 'surgical', 'monitoring', 'imaging',\n        'implantable', 'prosthetic', 'orthopedic', 'cardiovascular', 'neurological',\n        'ophthalmic', 'dental', 'dermatological', 'respiratory', 'anesthesia',\n        'infusion pump', 'defibrillator', 'pacemaker', 'catheter', 'stent',\n        'artificial intelligence', 'machine learning', 'software', 'mobile app'\n      ];\n\n      for (const deviceType of deviceTypeKeywords) {\n        if (normalizedContent.includes(deviceType.toLowerCase())) {\n          deviceTypes.push(deviceType);\n          confidence += 0.1;\n        }\n      }\n\n      // Risk level analysis\n      if (normalizedContent.includes('class iii') || normalizedContent.includes('implantable') || \n          normalizedContent.includes('life-sustaining') || normalizedContent.includes('critical')) {\n        riskLevel = 'high';\n        confidence += 0.3;\n      } else if (normalizedContent.includes('class ii') || normalizedContent.includes('monitoring')) {\n        riskLevel = 'medium';\n        confidence += 0.2;\n      } else if (normalizedContent.includes('class i') || normalizedContent.includes('non-invasive')) {\n        riskLevel = 'low';\n        confidence += 0.1;\n      }\n\n      // Therapeutic area analysis\n      const therapeuticAreas = [\n        'cardiology', 'neurology', 'oncology', 'orthopedics', 'ophthalmology',\n        'gastroenterology', 'urology', 'gynecology', 'dermatology', 'endocrinology'\n      ];\n\n      for (const area of therapeuticAreas) {\n        if (normalizedContent.includes(area.toLowerCase())) {\n          therapeuticArea = area;\n          categories.push(area);\n          confidence += 0.1;\n          break;\n        }\n      }\n\n      // Compliance requirements analysis\n      const complianceTerms = [\n        'cybersecurity', 'clinical evaluation', 'post-market surveillance',\n        'quality management', 'risk management', 'biocompatibility',\n        'software lifecycle', 'usability engineering', 'clinical investigation'\n      ];\n\n      for (const term of complianceTerms) {\n        if (normalizedContent.includes(term.toLowerCase())) {\n          complianceRequirements.push(term);\n          confidence += 0.1;\n        }\n      }\n\n      // Special categories\n      if (normalizedContent.includes('ai') || normalizedContent.includes('artificial intelligence')) {\n        categories.push('AI/ML Technology');\n        confidence += 0.2;\n      }\n\n      if (normalizedContent.includes('recall') || normalizedContent.includes('safety alert')) {\n        categories.push('Safety Alert');\n        confidence += 0.3;\n      }\n\n      // Ensure minimum categorization\n      if (categories.length === 0) {\n        categories.push('Medical Device');\n        confidence = Math.max(confidence, 0.5);\n      }\n\n      if (deviceTypes.length === 0) {\n        deviceTypes.push('Medical Device');\n      }\n\n      // Calculate AI confidence score based on multiple factors\n      const aiConfidenceScore = this.calculateAIConfidence(content, categories, deviceTypes);\n      \n      // Determine regulatory impact\n      const regulatoryImpact = this.determineRegulatoryImpact(riskLevel, categories);\n      \n      // Assess timeline sensitivity\n      const timelineSensitivity = this.assessTimelineSensitivity(content, categories);\n\n      return {\n        categories: Array.from(new Set(categories)),\n        confidence: Math.min(confidence, 1.0),\n        deviceTypes: Array.from(new Set(deviceTypes)),\n        riskLevel: riskLevel as 'critical' | 'high' | 'medium' | 'low',\n        therapeuticArea,\n        complianceRequirements: Array.from(new Set(complianceRequirements)),\n        aiConfidenceScore,\n        regulatoryImpact,\n        timelineSensitivity\n      };\n    } catch (error) {\n      console.error(\"❌ Error analyzing regulatory content:\", error);\n      throw error;\n    }\n  }\n\n  // Helper methods for enhanced AI analysis\n  private calculateAIConfidence(content: string, categories: string[], deviceTypes: string[]): number {\n    let confidence = 0.5; // Base confidence\n    \n    // Boost confidence based on specific medical device terminology\n    const medicalTerms = ['medical device', 'therapeutic', 'diagnostic', 'surgical', 'implantable'];\n    const foundTerms = medicalTerms.filter(term => content.toLowerCase().includes(term));\n    confidence += foundTerms.length * 0.1;\n    \n    // Boost confidence based on regulatory terminology\n    const regulatoryTerms = ['fda', 'ema', 'mdr', 'iso', 'iec', 'clinical evaluation'];\n    const foundRegTerms = regulatoryTerms.filter(term => content.toLowerCase().includes(term));\n    confidence += foundRegTerms.length * 0.15;\n    \n    // Boost confidence based on categorization success\n    confidence += Math.min(categories.length * 0.1, 0.3);\n    confidence += Math.min(deviceTypes.length * 0.1, 0.2);\n    \n    return Math.min(confidence, 1.0);\n  }\n\n  private determineRegulatoryImpact(riskLevel: string, categories: string[]): 'high' | 'medium' | 'low' {\n    if (riskLevel === 'critical' || categories.includes('Safety Alert') || categories.includes('Recall')) {\n      return 'high';\n    } else if (riskLevel === 'high' || categories.includes('AI/ML Technology') || categories.includes('Cybersecurity')) {\n      return 'medium';\n    } else {\n      return 'low';\n    }\n  }\n\n  private assessTimelineSensitivity(content: string, categories: string[]): 'urgent' | 'standard' | 'routine' {\n    const urgentKeywords = ['immediate', 'urgent', 'critical', 'emergency', 'recall', 'safety alert'];\n    const hasUrgentTerms = urgentKeywords.some(keyword => content.toLowerCase().includes(keyword));\n    \n    if (hasUrgentTerms || categories.includes('Safety Alert')) {\n      return 'urgent';\n    } else if (categories.includes('AI/ML Technology') || categories.includes('Cybersecurity')) {\n      return 'standard';\n    } else {\n      return 'routine';\n    }\n  }\n\n  // Regulatory update prioritization\n  async prioritizeRegulatoryUpdate(update: RegulatoryUpdate): Promise<{\n    priority: 'critical' | 'high' | 'medium' | 'low';\n    reasoning: string;\n    actionItems: string[];\n  }> {\n    try {\n      const analysis = await this.analyzeRegulatoryContent(\n        `${update.title} ${update.description || ''}`\n      );\n\n      let priority: 'critical' | 'high' | 'medium' | 'low' = 'medium';\n      const reasoning: string[] = [];\n      const actionItems: string[] = [];\n\n      // Critical priority factors\n      if (analysis.categories.includes('Safety Alert') || \n          update.updateType === 'recall' ||\n          analysis.riskLevel === 'high') {\n        priority = 'critical';\n        reasoning.push('Sicherheitsrelevante Inhalte oder Hochrisiko-Geräte');\n        actionItems.push('Sofortige Überprüfung der betroffenen Produkte');\n        actionItems.push('Benachrichtigung der relevanten Teams');\n      }\n\n      // High priority factors\n      else if (analysis.categories.includes('AI/ML Technology') ||\n               update.region === 'EU' && analysis.complianceRequirements.length > 2 ||\n               analysis.confidence > 0.8) {\n        priority = 'high';\n        reasoning.push('Neue Technologien oder umfangreiche Compliance-Anforderungen');\n        actionItems.push('Detaillierte Analyse der Auswirkungen');\n        actionItems.push('Aktualisierung der internen Richtlinien prüfen');\n      }\n\n      // Medium priority (default)\n      else if (analysis.confidence > 0.5) {\n        priority = 'medium';\n        reasoning.push('Standardmäßige regulatorische Änderungen');\n        actionItems.push('Routinemäßige Überprüfung einplanen');\n      }\n\n      // Low priority\n      else {\n        priority = 'low';\n        reasoning.push('Geringfügige oder allgemeine Informationen');\n        actionItems.push('Zur Kenntnisnahme archivieren');\n      }\n\n      return {\n        priority,\n        reasoning: reasoning.join('; '),\n        actionItems\n      };\n    } catch (error) {\n      console.error(\"Error prioritizing regulatory update:\", error);\n      return {\n        priority: 'medium',\n        reasoning: 'Automatische Priorisierung fehlgeschlagen',\n        actionItems: ['Manuelle Überprüfung erforderlich']\n      };\n    }\n  }\n\n  // Legal case analysis\n  async analyzeLegalCase(caseData: {\n    title: string;\n    summary: string;\n    keyIssues: string[];\n  }): Promise<{\n    themes: string[];\n    riskAssessment: string;\n    precedentValue: 'high' | 'medium' | 'low';\n    actionItems: string[];\n  }> {\n    try {\n      const searchText = `${caseData.title} ${caseData.summary} ${caseData.keyIssues.join(' ')}`.toLowerCase();\n      \n      const themes: string[] = [];\n      let precedentValue: 'high' | 'medium' | 'low' = 'medium';\n      const actionItems: string[] = [];\n\n      // Legal theme detection\n      const legalThemes = {\n        'Produkthaftung': ['product liability', 'defective device', 'manufacturer liability'],\n        'Regulatorische Compliance': ['FDA violation', 'regulatory breach', 'compliance failure'],\n        'Klinische Studien': ['clinical trial', 'informed consent', 'ethics committee'],\n        'Patente': ['patent infringement', 'intellectual property', 'licensing'],\n        'Datenschutz': ['GDPR', 'DSGVO', 'data protection', 'privacy'],\n        'KI/ML-Geräte': ['artificial intelligence', 'machine learning', 'AI device']\n      };\n\n      for (const [theme, keywords] of Object.entries(legalThemes)) {\n        if (keywords.some(keyword => searchText.includes(keyword.toLowerCase()))) {\n          themes.push(theme);\n        }\n      }\n\n      // Precedent value assessment\n      if (themes.includes('Produkthaftung') || themes.includes('Regulatorische Compliance')) {\n        precedentValue = 'high';\n        actionItems.push('Überprüfung der aktuellen Compliance-Maßnahmen');\n        actionItems.push('Risikoanalyse für ähnliche Produkte');\n      } else if (themes.includes('KI/ML-Geräte') || themes.includes('Datenschutz')) {\n        precedentValue = 'high';\n        actionItems.push('Bewertung der Auswirkungen auf digitale Gesundheitslösungen');\n      } else if (themes.length > 0) {\n        precedentValue = 'medium';\n        actionItems.push('Monitoring ähnlicher Fälle');\n      } else {\n        precedentValue = 'low';\n        actionItems.push('Zur Kenntnisnahme archivieren');\n      }\n\n      const riskAssessment = precedentValue === 'high' \n        ? 'Hohes Risiko - Sofortige Maßnahmen erforderlich'\n        : precedentValue === 'medium'\n        ? 'Mittleres Risiko - Regelmäßige Überwachung'\n        : 'Geringes Risiko - Allgemeine Beobachtung';\n\n      return {\n        themes: themes.length > 0 ? themes : ['Allgemein'],\n        riskAssessment,\n        precedentValue,\n        actionItems\n      };\n    } catch (error) {\n      console.error(\"Error analyzing legal case:\", error);\n      return {\n        themes: ['Analysefehler'],\n        riskAssessment: 'Manuelle Überprüfung erforderlich',\n        precedentValue: 'medium',\n        actionItems: ['Detaillierte manuelle Analyse durchführen']\n      };\n    }\n  }\n\n  // Market trend analysis\n  async analyzeMarketTrends(regulatoryUpdates: RegulatoryUpdate[]): Promise<{\n    emergingTrends: string[];\n    deviceTypeTrends: { [key: string]: number };\n    regionActivity: { [key: string]: number };\n    recommendations: string[];\n  }> {\n    try {\n      const emergingTrends: string[] = [];\n      const deviceTypeTrends: { [key: string]: number } = {};\n      const regionActivity: { [key: string]: number } = {};\n      const recommendations: string[] = [];\n\n      // Analyze recent updates (last 30 days)\n      const recentUpdates = regulatoryUpdates.filter(update => {\n        const updateDate = new Date(update.publishedAt);\n        const thirtyDaysAgo = new Date();\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n        return updateDate > thirtyDaysAgo;\n      });\n\n      // Count by region\n      for (const update of recentUpdates) {\n        regionActivity[update.region] = (regionActivity[update.region] || 0) + 1;\n      }\n\n      // Analyze content for trends\n      const aiMlCount = recentUpdates.filter(u => \n        u.title.toLowerCase().includes('ai') || \n        u.title.toLowerCase().includes('artificial intelligence') ||\n        u.description?.toLowerCase().includes('machine learning')\n      ).length;\n\n      const cybersecurityCount = recentUpdates.filter(u => \n        u.title.toLowerCase().includes('cybersecurity') || \n        u.description?.toLowerCase().includes('cyber')\n      ).length;\n\n      const digitalHealthCount = recentUpdates.filter(u => \n        u.title.toLowerCase().includes('digital') || \n        u.title.toLowerCase().includes('telemedicine') ||\n        u.description?.toLowerCase().includes('remote monitoring')\n      ).length;\n\n      // Identify emerging trends\n      if (aiMlCount > 5) {\n        emergingTrends.push('KI/ML-Integration in Medizintechnik');\n        recommendations.push('Verstärkter Fokus auf KI-Compliance und Validierung erforderlich');\n      }\n\n      if (cybersecurityCount > 3) {\n        emergingTrends.push('Cybersecurity-Anforderungen verschärfen sich');\n        recommendations.push('Cybersecurity-Assessment für alle vernetzten Geräte durchführen');\n      }\n\n      if (digitalHealthCount > 7) {\n        emergingTrends.push('Digitale Gesundheitslösungen expandieren');\n        recommendations.push('Digital Health Strategie überprüfen und anpassen');\n      }\n\n      // Device type trending\n      deviceTypeTrends['AI/ML Devices'] = aiMlCount;\n      deviceTypeTrends['Digital Health'] = digitalHealthCount;\n      deviceTypeTrends['Connected Devices'] = cybersecurityCount;\n\n      // General recommendations based on activity\n      const totalActivity = Object.values(regionActivity).reduce((sum, count) => sum + count, 0);\n      if (totalActivity > 20) {\n        recommendations.push('Erhöhte regulatorische Aktivität - Compliance-Monitoring verstärken');\n      }\n\n      return {\n        emergingTrends,\n        deviceTypeTrends,\n        regionActivity,\n        recommendations\n      };\n    } catch (error) {\n      console.error(\"❌ Error analyzing market trends:\", error);\n      return {\n        emergingTrends: ['Trend-Analyse nicht verfügbar'],\n        deviceTypeTrends: {},\n        regionActivity: {},\n        recommendations: ['Manuelle Marktanalyse erforderlich']\n      };\n    }\n  }\n\n  // Enhanced market trend analysis with ML-powered insights\n  async analyzeMarketTrendsML(updates: RegulatoryUpdate[]): Promise<MarketTrendAnalysis> {\n    try {\n      const emergingTechnologies: string[] = [];\n      const riskTrends: Array<{ category: string; trend: 'increasing' | 'decreasing' | 'stable'; significance: number }> = [];\n      const regulatoryFocus: string[] = [];\n      const predictedChanges: Array<{ area: string; probability: number; timeframe: string; impact: 'high' | 'medium' | 'low' }> = [];\n\n      // Analyze last 90 days for trend detection\n      const ninetyDaysAgo = new Date();\n      ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);\n      \n      const recentUpdates = updates.filter(update => \n        new Date(update.publishedAt) > ninetyDaysAgo\n      );\n\n      // Technology trend analysis\n      const aiTrend = this.analyzeTechnologyTrend(recentUpdates, ['ai', 'artificial intelligence', 'machine learning']);\n      const iotTrend = this.analyzeTechnologyTrend(recentUpdates, ['iot', 'internet of things', 'connected device']);\n      const biomarkerTrend = this.analyzeTechnologyTrend(recentUpdates, ['biomarker', 'personalized medicine', 'precision medicine']);\n\n      if (aiTrend.count > 5) {\n        emergingTechnologies.push('AI-powered Medical Devices');\n        riskTrends.push({ category: 'AI Regulation', trend: 'increasing', significance: aiTrend.significance });\n      }\n\n      if (iotTrend.count > 3) {\n        emergingTechnologies.push('IoT Medical Devices');\n        riskTrends.push({ category: 'Cybersecurity', trend: 'increasing', significance: iotTrend.significance });\n      }\n\n      // Regional regulatory focus analysis\n      const euMdrFocus = recentUpdates.filter(u => \n        u.region === 'EU' && (u.title.toLowerCase().includes('mdr') || u.description?.toLowerCase().includes('medical device regulation'))\n      ).length;\n\n      const fdaFocus = recentUpdates.filter(u => \n        u.region === 'US' && (u.title.toLowerCase().includes('fda') || u.updateType === 'approval')\n      ).length;\n\n      if (euMdrFocus > 5) {\n        regulatoryFocus.push('EU MDR Enforcement Intensifying');\n      }\n\n      if (fdaFocus > 10) {\n        regulatoryFocus.push('FDA Approval Process Evolution');\n      }\n\n      // Predicted regulatory changes\n      predictedChanges.push({\n        area: 'AI/ML Device Regulation',\n        probability: 0.85,\n        timeframe: '6-12 Monate',\n        impact: 'high'\n      });\n\n      predictedChanges.push({\n        area: 'Cybersecurity Standards',\n        probability: 0.75,\n        timeframe: '3-6 Monate',\n        impact: 'medium'\n      });\n\n      return {\n        emergingTechnologies,\n        riskTrends,\n        regulatoryFocus,\n        predictedChanges\n      };\n    } catch (error) {\n      console.error(\"❌ Error in ML trend analysis:\", error);\n      return {\n        emergingTechnologies: [],\n        riskTrends: [],\n        regulatoryFocus: [],\n        predictedChanges: []\n      };\n    }\n  }\n\n  private analyzeTechnologyTrend(updates: RegulatoryUpdate[], keywords: string[]): { count: number; significance: number } {\n    const matchingUpdates = updates.filter(update => \n      keywords.some(keyword => \n        update.title.toLowerCase().includes(keyword) || \n        update.description?.toLowerCase().includes(keyword)\n      )\n    );\n\n    return {\n      count: matchingUpdates.length,\n      significance: Math.min(matchingUpdates.length / updates.length, 1.0)\n    };\n  }\n}\n\nexport const aiService = new AIService();"]}