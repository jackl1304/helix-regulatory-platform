{"version":3,"file":"aiSummarizationService.js","sourceRoot":"","sources":["../../server/services/aiSummarizationService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\n\ninterface SummaryRequest {\n  contentId: string;\n  contentType: 'regulatory_update' | 'legal_case' | 'clinical_study';\n  priority: 'standard' | 'urgent';\n  targetAudience: 'technical' | 'executive' | 'regulatory';\n}\n\ninterface SummaryResult {\n  id: string;\n  originalContentId: string;\n  summaryType: string;\n  keyPoints: string[];\n  impactAssessment: string;\n  actionItems: string[];\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\n  confidence: number;\n  generatedAt: Date;\n  wordCount: number;\n  readingTime: number;\n}\n\ninterface TrendAnalysis {\n  timeframe: string;\n  trends: TrendItem[];\n  emergingTopics: string[];\n  riskFactors: string[];\n  recommendations: string[];\n}\n\ninterface TrendItem {\n  topic: string;\n  frequency: number;\n  severity: 'low' | 'medium' | 'high';\n  trajectory: 'increasing' | 'stable' | 'decreasing';\n  relatedAuthorities: string[];\n}\n\nexport class AISummarizationService {\n  private apiUrl = 'https://api.anthropic.com/v1/messages'; // ðŸ”´ MOCK DATA - Placeholder for AI service - AUTHENTIC API KEY REQUIRED\n  private maxTokens = 1000;\n  private temperature = 0.3; // Lower for more consistent summaries\n  \n  async generateSummary(request: SummaryRequest): Promise<SummaryResult> {\n    try {\n      console.log(`[AI Summary] Generating summary for ${request.contentId}`);\n      \n      // Get the content to summarize\n      const content = await this.getContentById(request.contentId, request.contentType);\n      if (!content) {\n        throw new Error(`Content not found: ${request.contentId}`);\n      }\n      \n      // Generate AI summary using production implementation\n      const summaryData = await this.callAISummarizationAPI(content, request);\n      \n      const summary: SummaryResult = {\n        id: `summary-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        originalContentId: request.contentId,\n        summaryType: `${request.targetAudience}_summary`,\n        keyPoints: summaryData.keyPoints,\n        impactAssessment: summaryData.impactAssessment,\n        actionItems: summaryData.actionItems,\n        riskLevel: summaryData.riskLevel,\n        confidence: summaryData.confidence,\n        generatedAt: new Date(),\n        wordCount: summaryData.wordCount,\n        readingTime: Math.ceil(summaryData.wordCount / 200) // 200 words per minute\n      };\n      \n      console.log(`[AI Summary] Generated summary with ${summary.keyPoints.length} key points`);\n      return summary;\n    } catch (error) {\n      console.error('[AI Summary] Error generating summary:', error);\n      throw error;\n    }\n  }\n\n  private async getContentById(contentId: string, contentType: string): Promise<any> {\n    try {\n      switch (contentType) {\n        case 'regulatory_update':\n          const updates = await storage.getAllRegulatoryUpdates();\n          return updates.find(u => u.id === contentId);\n        case 'legal_case':\n          const legalCases = await storage.getAllLegalCases();\n          return legalCases.find(l => l.id === contentId);\n        default:\n          return null;\n      }\n    } catch (error) {\n      console.error('[AI Summary] Error fetching content:', error);\n      return null;\n    }\n  }\n\n  private async callAISummarizationAPI(content: any, request: SummaryRequest): Promise<any> {\n    try {\n      // Mock AI implementation for development\n      // In production, this would call actual AI service\n      console.log('[AI Summary] Using mock AI service for development');\n      \n      return this.generateMockSummary(content, request);\n    } catch (error) {\n      console.error('[AI Summary] AI API call failed:', error);\n      // Return mock data as fallback\n      return this.generateMockSummary(content, request);\n    }\n  }\n\n  private generateMockSummary(content: any, request: SummaryRequest): any {\n    const contentText = content.title + ' ' + content.content;\n    const wordCount = contentText.split(' ').length;\n    \n    // Analyze content for key themes\n    const themes = this.extractThemes(contentText);\n    const riskLevel = this.assessRiskLevel(contentText, content);\n    \n    const summaryData = {\n      keyPoints: this.generateKeyPoints(content, request.targetAudience, themes),\n      impactAssessment: this.generateImpactAssessment(content, riskLevel),\n      actionItems: this.generateActionItems(content, request.targetAudience),\n      riskLevel,\n      confidence: 0.85, // Mock confidence score\n      wordCount: Math.floor(wordCount * 0.3) // Summary is ~30% of original\n    };\n    \n    return summaryData;\n  }\n\n  private extractThemes(text: string): string[] {\n    const themes: string[] = [];\n    const lowercaseText = text.toLowerCase();\n    \n    // Medical device themes\n    if (lowercaseText.includes('device') || lowercaseText.includes('medical')) {\n      themes.push('Medical Device');\n    }\n    if (lowercaseText.includes('safety') || lowercaseText.includes('recall')) {\n      themes.push('Safety Alert');\n    }\n    if (lowercaseText.includes('approval') || lowercaseText.includes('clearance')) {\n      themes.push('Regulatory Approval');\n    }\n    if (lowercaseText.includes('clinical') || lowercaseText.includes('study')) {\n      themes.push('Clinical Evidence');\n    }\n    if (lowercaseText.includes('software') || lowercaseText.includes('ai')) {\n      themes.push('Digital Health');\n    }\n    if (lowercaseText.includes('implant') || lowercaseText.includes('cardiac')) {\n      themes.push('Implantable Device');\n    }\n    \n    return themes.length > 0 ? themes : ['General'];\n  }\n\n  private assessRiskLevel(text: string, content: any): 'low' | 'medium' | 'high' | 'critical' {\n    const lowercaseText = text.toLowerCase();\n    \n    // Critical risk indicators\n    if (lowercaseText.includes('death') || \n        lowercaseText.includes('life-threatening') ||\n        lowercaseText.includes('emergency') ||\n        content.priority === 'critical') {\n      return 'critical';\n    }\n    \n    // High risk indicators\n    if (lowercaseText.includes('serious') ||\n        lowercaseText.includes('injury') ||\n        lowercaseText.includes('malfunction') ||\n        lowercaseText.includes('recall') ||\n        content.priority === 'high') {\n      return 'high';\n    }\n    \n    // Medium risk indicators\n    if (lowercaseText.includes('warning') ||\n        lowercaseText.includes('advisory') ||\n        lowercaseText.includes('precaution') ||\n        content.priority === 'medium') {\n      return 'medium';\n    }\n    \n    return 'low';\n  }\n\n  private generateKeyPoints(content: any, audience: string, themes: string[]): string[] {\n    const keyPoints: string[] = [];\n    \n    // Authority and type\n    keyPoints.push(`${content.authority || 'Regulatory Authority'} issued ${content.type || 'update'}`);\n    \n    // Theme-based points\n    if (themes.includes('Safety Alert')) {\n      keyPoints.push('Safety concern identified requiring immediate attention');\n    }\n    if (themes.includes('Regulatory Approval')) {\n      keyPoints.push('New regulatory pathway or approval granted');\n    }\n    if (themes.includes('Clinical Evidence')) {\n      keyPoints.push('Clinical data requirements or study results reported');\n    }\n    \n    // Audience-specific points\n    switch (audience) {\n      case 'executive':\n        keyPoints.push('Business impact assessment required for affected products');\n        break;\n      case 'technical':\n        keyPoints.push('Technical specifications and compliance requirements detailed');\n        break;\n      case 'regulatory':\n        keyPoints.push('Regulatory submission implications and timeline considerations');\n        break;\n    }\n    \n    // Region/jurisdiction\n    if (content.region) {\n      keyPoints.push(`Applies to ${content.region} market operations`);\n    }\n    \n    return keyPoints.slice(0, 5); // Limit to 5 key points\n  }\n\n  private generateImpactAssessment(content: any, riskLevel: string): string {\n    const impacts: string[] = [];\n    \n    switch (riskLevel) {\n      case 'critical':\n        impacts.push('Immediate action required - potential for serious harm');\n        impacts.push('Market withdrawal or suspension may be necessary');\n        break;\n      case 'high':\n        impacts.push('Significant compliance implications for affected devices');\n        impacts.push('Review of quality systems and post-market surveillance recommended');\n        break;\n      case 'medium':\n        impacts.push('Moderate impact on regulatory strategy and compliance activities');\n        impacts.push('Documentation updates and process reviews advised');\n        break;\n      case 'low':\n        impacts.push('Minimal immediate impact on current operations');\n        impacts.push('Monitor for future developments and trend implications');\n        break;\n    }\n    \n    return impacts.join(' ');\n  }\n\n  private generateActionItems(content: any, audience: string): string[] {\n    const actions: string[] = [];\n    \n    // Common actions\n    actions.push('Review current product portfolio for applicability');\n    actions.push('Assess compliance with updated requirements');\n    \n    // Audience-specific actions\n    switch (audience) {\n      case 'executive':\n        actions.push('Evaluate business risk and resource allocation');\n        actions.push('Consider impact on market strategy and timeline');\n        break;\n      case 'technical':\n        actions.push('Update technical documentation and specifications');\n        actions.push('Review design controls and verification protocols');\n        break;\n      case 'regulatory':\n        actions.push('Update regulatory submission strategy');\n        actions.push('Coordinate with regulatory consultants if needed');\n        break;\n    }\n    \n    return actions;\n  }\n\n  async batchSummarizeRecent(hours: number = 24): Promise<SummaryResult[]> {\n    try {\n      console.log(`[AI Summary] Batch summarizing content from last ${hours} hours`);\n      \n      const cutoffDate = new Date(Date.now() - hours * 60 * 60 * 1000);\n      const allUpdates = await storage.getAllRegulatoryUpdates();\n      \n      const recentUpdates = allUpdates.filter(update => \n        new Date(update.published_at) > cutoffDate\n      ).slice(0, 10); // Limit to 10 most recent\n      \n      const summaries: SummaryResult[] = [];\n      \n      for (const update of recentUpdates) {\n        try {\n          const request: SummaryRequest = {\n            contentId: update.id,\n            contentType: 'regulatory_update',\n            priority: update.priority === 'critical' || update.priority === 'high' ? 'urgent' : 'standard',\n            targetAudience: 'regulatory'\n          };\n          \n          const summary = await this.generateSummary(request);\n          summaries.push(summary);\n          \n          // Small delay between API calls\n          await new Promise(resolve => setTimeout(resolve, 500));\n        } catch (error) {\n          console.error(`[AI Summary] Error summarizing ${update.id}:`, error);\n        }\n      }\n      \n      console.log(`[AI Summary] Generated ${summaries.length} batch summaries`);\n      return summaries;\n    } catch (error) {\n      console.error('[AI Summary] Batch summarization failed:', error);\n      throw error;\n    }\n  }\n\n  async analyzeTrends(timeframe: string = '30d'): Promise<TrendAnalysis> {\n    try {\n      console.log(`[AI Summary] Analyzing trends for timeframe: ${timeframe}`);\n      \n      const allUpdates = await storage.getAllRegulatoryUpdates();\n      const days = this.parseTimeframe(timeframe);\n      const cutoffDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000);\n      \n      const recentUpdates = allUpdates.filter(update => \n        new Date(update.published_at) > cutoffDate\n      );\n      \n      console.log(`[AI Summary] Analyzing ${recentUpdates.length} updates from last ${days} days`);\n      \n      // Extract trends\n      const topicFrequency = this.analyzeTopicFrequency(recentUpdates);\n      const trends = this.generateTrendItems(topicFrequency, recentUpdates);\n      const emergingTopics = this.identifyEmergingTopics(recentUpdates);\n      const riskFactors = this.identifyRiskFactors(recentUpdates);\n      const recommendations = this.generateTrendRecommendations(trends, riskFactors);\n      \n      const analysis: TrendAnalysis = {\n        timeframe,\n        trends,\n        emergingTopics,\n        riskFactors,\n        recommendations\n      };\n      \n      console.log(`[AI Summary] Generated trend analysis with ${trends.length} trends`);\n      return analysis;\n    } catch (error) {\n      console.error('[AI Summary] Trend analysis failed:', error);\n      throw error;\n    }\n  }\n\n  private parseTimeframe(timeframe: string): number {\n    const match = timeframe.match(/(\\d+)([dwmy])/);\n    if (!match) return 30; // Default 30 days\n    \n    const [, num, unit] = match;\n    const value = parseInt(num, 10);\n    \n    switch (unit) {\n      case 'd': return value;\n      case 'w': return value * 7;\n      case 'm': return value * 30;\n      case 'y': return value * 365;\n      default: return 30;\n    }\n  }\n\n  private analyzeTopicFrequency(updates: any[]): Record<string, number> {\n    const frequency: Record<string, number> = {};\n    \n    for (const update of updates) {\n      const themes = this.extractThemes(update.title + ' ' + update.content);\n      for (const theme of themes) {\n        frequency[theme] = (frequency[theme] || 0) + 1;\n      }\n    }\n    \n    return frequency;\n  }\n\n  private generateTrendItems(frequency: Record<string, number>, updates: any[]): TrendItem[] {\n    const trends: TrendItem[] = [];\n    \n    for (const [topic, freq] of Object.entries(frequency)) {\n      if (freq < 2) continue; // Only include topics with multiple mentions\n      \n      const relatedUpdates = updates.filter(u => \n        this.extractThemes(u.title + ' ' + u.content).includes(topic)\n      );\n      \n      const authorities = Array.from(new Set(relatedUpdates.map(u => u.authority)));\n      const severity = this.assessTopicSeverity(relatedUpdates);\n      const trajectory = this.assessTopicTrajectory(relatedUpdates);\n      \n      trends.push({\n        topic,\n        frequency: freq,\n        severity,\n        trajectory,\n        relatedAuthorities: authorities\n      });\n    }\n    \n    return trends.sort((a, b) => b.frequency - a.frequency);\n  }\n\n  private assessTopicSeverity(updates: any[]): 'low' | 'medium' | 'high' {\n    const priorities = updates.map(u => u.priority || 'low');\n    const highPriorityCount = priorities.filter(p => p === 'high' || p === 'critical').length;\n    \n    if (highPriorityCount / updates.length > 0.5) return 'high';\n    if (highPriorityCount > 0) return 'medium';\n    return 'low';\n  }\n\n  private assessTopicTrajectory(updates: any[]): 'increasing' | 'stable' | 'decreasing' {\n    // Simple trend analysis based on timing\n    const sortedUpdates = updates.sort((a, b) => \n      new Date(a.published_at).getTime() - new Date(b.published_at).getTime()\n    );\n    \n    const midpoint = Math.floor(sortedUpdates.length / 2);\n    const firstHalf = sortedUpdates.slice(0, midpoint);\n    const secondHalf = sortedUpdates.slice(midpoint);\n    \n    if (secondHalf.length > firstHalf.length * 1.2) return 'increasing';\n    if (firstHalf.length > secondHalf.length * 1.2) return 'decreasing';\n    return 'stable';\n  }\n\n  private identifyEmergingTopics(updates: any[]): string[] {\n    const emergingTopics: string[] = [];\n    const recentUpdates = updates.slice(0, Math.floor(updates.length * 0.3)); // Last 30%\n    \n    const recentThemes = this.analyzeTopicFrequency(recentUpdates);\n    const allThemes = this.analyzeTopicFrequency(updates);\n    \n    for (const [theme, recentFreq] of Object.entries(recentThemes)) {\n      const totalFreq = allThemes[theme];\n      const recentRatio = recentFreq / totalFreq;\n      \n      if (recentRatio > 0.6 && totalFreq >= 3) { // 60% of mentions are recent\n        emergingTopics.push(theme);\n      }\n    }\n    \n    return emergingTopics.slice(0, 5); // Top 5 emerging topics\n  }\n\n  private identifyRiskFactors(updates: any[]): string[] {\n    const riskFactors: string[] = [];\n    \n    const criticalUpdates = updates.filter(u => u.priority === 'critical');\n    const highUpdates = updates.filter(u => u.priority === 'high');\n    \n    if (criticalUpdates.length > 0) {\n      riskFactors.push(`${criticalUpdates.length} critical regulatory alerts detected`);\n    }\n    \n    if (highUpdates.length > updates.length * 0.3) {\n      riskFactors.push('High volume of high-priority regulatory activity');\n    }\n    \n    const safetyUpdates = updates.filter(u => \n      (u.title + ' ' + u.content).toLowerCase().includes('safety')\n    );\n    if (safetyUpdates.length > updates.length * 0.2) {\n      riskFactors.push('Increased safety-related regulatory communications');\n    }\n    \n    return riskFactors;\n  }\n\n  private generateTrendRecommendations(trends: TrendItem[], riskFactors: string[]): string[] {\n    const recommendations: string[] = [];\n    \n    const highSeverityTrends = trends.filter(t => t.severity === 'high');\n    if (highSeverityTrends.length > 0) {\n      recommendations.push('Immediate review recommended for high-severity regulatory trends');\n    }\n    \n    const increasingTrends = trends.filter(t => t.trajectory === 'increasing');\n    if (increasingTrends.length > 0) {\n      recommendations.push('Monitor increasing regulatory activity patterns for early intervention');\n    }\n    \n    if (riskFactors.length > 2) {\n      recommendations.push('Enhanced compliance monitoring advised due to elevated risk factors');\n    }\n    \n    recommendations.push('Regular trend analysis should be conducted weekly for optimal regulatory intelligence');\n    \n    return recommendations;\n  }\n}"]}