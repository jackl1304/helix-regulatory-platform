{"version":3,"file":"knowledge-extraction.service.js","sourceRoot":"","sources":["../../server/services/knowledge-extraction.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from './logger.service';\n// Define types locally since @shared/types doesn't exist\ninterface IStorage {\n  // Add minimal interface for the methods we need\n  getAllRegulatoryUpdates(): Promise<any[]>;\n  getAllLegalCases(): Promise<any[]>;\n  getAllKnowledgeArticles(): Promise<any[]>;\n  createKnowledgeArticle(data: any): Promise<any>;\n}\n\ninterface RegulatoryUpdate {\n  id: string;\n  title: string;\n  description?: string;\n  content?: string;\n}\n\ninterface LegalCase {\n  id: string;\n  title: string;\n  content?: string;\n  summary?: string;\n}\n\nclass AppError extends Error {\n  public readonly statusCode: number;\n  \n  constructor(message: string, statusCode: number = 500) {\n    super(message);\n    this.statusCode = statusCode;\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\nclass DatabaseError extends AppError {\n  constructor(message: string) {\n    super(message, 500);\n  }\n}\n\nconst logger = new Logger('KnowledgeExtraction');\n\nexport interface ExtractedArticle {\n  title: string;\n  link: string;\n  source: string;\n  sourceType: 'regulatory' | 'legal';\n  category: string;\n  region: string;\n  extractedAt: Date;\n}\n\nexport interface ArticleExtractionStats {\n  totalProcessed: number;\n  articlesExtracted: number;\n  duplicatesSkipped: number;\n  errorsEncountered: number;\n  sourcesProcessed: string[];\n}\n\nexport class KnowledgeExtractionService {\n  constructor(private storage: IStorage) {}\n\n  /**\n   * Extrahiert Artikel aus allen verfügbaren Datenquellen\n   */\n  async extractArticlesFromAllSources(): Promise<ArticleExtractionStats> {\n    logger.info('Starting knowledge article extraction from all data sources');\n    \n    const stats: ArticleExtractionStats = {\n      totalProcessed: 0,\n      articlesExtracted: 0,\n      duplicatesSkipped: 0,\n      errorsEncountered: 0,\n      sourcesProcessed: []\n    };\n\n    try {\n      // Regulatorische Updates verarbeiten\n      const regulatoryStats = await this.extractFromRegulatoryUpdates();\n      this.mergeStats(stats, regulatoryStats);\n\n      // Rechtsfälle verarbeiten\n      const legalStats = await this.extractFromLegalCases();\n      this.mergeStats(stats, legalStats);\n\n      logger.info('Knowledge article extraction completed', { \n        totalProcessed: stats.totalProcessed,\n        articlesExtracted: stats.articlesExtracted,\n        duplicatesSkipped: stats.duplicatesSkipped,\n        errorsEncountered: stats.errorsEncountered\n      });\n      return stats;\n    } catch (error) {\n      logger.error('Failed to extract knowledge articles', { error });\n      throw new AppError('Knowledge article extraction failed', 500);\n    }\n  }\n\n  /**\n   * Extrahiert Artikel aus regulatorischen Updates\n   */\n  private async extractFromRegulatoryUpdates(): Promise<Partial<ArticleExtractionStats>> {\n    logger.info('Extracting articles from regulatory updates');\n    \n    const stats = {\n      totalProcessed: 0,\n      articlesExtracted: 0,\n      duplicatesSkipped: 0,\n      errorsEncountered: 0,\n      sourcesProcessed: ['regulatory_updates']\n    };\n\n    try {\n      const updates = await this.storage.getAllRegulatoryUpdates();\n      stats.totalProcessed = updates.length;\n\n      for (const update of updates) {\n        try {\n          const extracted = this.extractArticleFromRegulatoryUpdate(update);\n          if (extracted) {\n            const isDuplicate = await this.checkForDuplicate(extracted);\n            \n            if (!isDuplicate) {\n              await this.createKnowledgeArticle(extracted);\n              stats.articlesExtracted++;\n              \n              logger.debug('Created knowledge article from regulatory update', {\n                title: extracted.title,\n                source: extracted.source\n              });\n            } else {\n              stats.duplicatesSkipped++;\n            }\n          }\n        } catch (error) {\n          stats.errorsEncountered++;\n          logger.warn('Failed to process regulatory update', {\n            updateId: update.id,\n            error: error instanceof Error ? error.message : String(error)\n          });\n        }\n      }\n\n      return stats;\n    } catch (error) {\n      logger.error('Failed to extract from regulatory updates', { error });\n      throw new DatabaseError('Failed to fetch regulatory updates', 'getAllRegulatoryUpdates');\n    }\n  }\n\n  /**\n   * Extrahiert Artikel aus Rechtsfällen\n   */\n  private async extractFromLegalCases(): Promise<Partial<ArticleExtractionStats>> {\n    logger.info('Extracting articles from legal cases');\n    \n    const stats = {\n      totalProcessed: 0,\n      articlesExtracted: 0,\n      duplicatesSkipped: 0,\n      errorsEncountered: 0,\n      sourcesProcessed: ['legal_cases']\n    };\n\n    try {\n      const legalCases = await this.storage.getAllLegalCases();\n      stats.totalProcessed = legalCases.length;\n\n      for (const legalCase of legalCases) {\n        try {\n          const extracted = this.extractArticleFromLegalCase(legalCase);\n          if (extracted) {\n            const isDuplicate = await this.checkForDuplicate(extracted);\n            \n            if (!isDuplicate) {\n              await this.createKnowledgeArticle(extracted);\n              stats.articlesExtracted++;\n              \n              logger.debug('Created knowledge article from legal case', {\n                title: extracted.title,\n                source: extracted.source\n              });\n            } else {\n              stats.duplicatesSkipped++;\n            }\n          }\n        } catch (error) {\n          stats.errorsEncountered++;\n          logger.warn('Failed to process legal case', {\n            caseId: legalCase.id,\n            error: error instanceof Error ? error.message : String(error)\n          });\n        }\n      }\n\n      return stats;\n    } catch (error) {\n      logger.error('Failed to extract from legal cases', { error });\n      throw new DatabaseError('Failed to fetch legal cases', 'getAllLegalCases');\n    }\n  }\n\n  /**\n   * Extrahiert Artikel-Informationen aus einem regulatorischen Update\n   */\n  private extractArticleFromRegulatoryUpdate(update: RegulatoryUpdate): ExtractedArticle | null {\n    if (!update.title) {\n      return null;\n    }\n\n    // Use source_url instead of url, fallback to constructed link\n    const link = update.source_url || `https://example.com/regulatory/${update.id}`;\n\n    return {\n      title: this.cleanTitle(update.title),\n      link: link,\n      source: update.source || 'Regulatory Authority',\n      sourceType: 'regulatory',\n      category: this.categorizeRegulatoryUpdate(update),\n      region: update.region || 'Global',\n      extractedAt: new Date()\n    };\n  }\n\n  /**\n   * Extrahiert Artikel-Informationen aus einem Rechtsfall\n   */\n  private extractArticleFromLegalCase(legalCase: LegalCase): ExtractedArticle | null {\n    if (!legalCase.title) {\n      return null;\n    }\n\n    // Konstruiere einen Link falls nicht vorhanden\n    const link = this.constructLegalCaseLink(legalCase);\n\n    return {\n      title: this.cleanTitle(legalCase.title),\n      link: link,\n      source: legalCase.court,\n      sourceType: 'legal',\n      category: this.categorizeLegalCase(legalCase),\n      region: legalCase.jurisdiction,\n      extractedAt: new Date()\n    };\n  }\n\n  /**\n   * Bereinigt und normalisiert Titel\n   */\n  private cleanTitle(title: string): string {\n    return title\n      .trim()\n      .replace(/\\s+/g, ' ')\n      .replace(/[^\\w\\s\\-\\(\\)\\[\\].,;:!?]/g, '')\n      .substring(0, 200); // Titel-Länge begrenzen\n  }\n\n  /**\n   * Kategorisiert regulatorische Updates\n   */\n  private categorizeRegulatoryUpdate(update: RegulatoryUpdate): string {\n    const title = update.title.toLowerCase();\n    const type = (update.update_type || '').toLowerCase();\n\n    if (title.includes('software') || title.includes('samd')) {\n      return 'Software & Digital Health';\n    } else if (title.includes('clinical') || title.includes('trial')) {\n      return 'Clinical Trials';\n    } else if (title.includes('quality') || title.includes('iso')) {\n      return 'Quality Management';\n    } else if (type.includes('guidance')) {\n      return 'Regulatory Guidance';\n    } else if (type.includes('standard')) {\n      return 'Standards & Compliance';\n    } else {\n      return 'General Regulatory';\n    }\n  }\n\n  /**\n   * Kategorisiert Rechtsfälle\n   */\n  private categorizeLegalCase(legalCase: LegalCase): string {\n    const title = legalCase.title.toLowerCase();\n    const issues = (legalCase.keywords || []).join(' ').toLowerCase();\n\n    if (title.includes('patent') || issues.includes('patent')) {\n      return 'Patent Law';\n    } else if (title.includes('product liability') || issues.includes('liability')) {\n      return 'Product Liability';\n    } else if (title.includes('regulatory') || issues.includes('fda')) {\n      return 'Regulatory Compliance';\n    } else if (title.includes('antitrust') || issues.includes('competition')) {\n      return 'Antitrust & Competition';\n    } else {\n      return 'General Legal';\n    }\n  }\n\n  /**\n   * Konstruiert einen Link für Rechtsfälle\n   */\n  private constructLegalCaseLink(legalCase: LegalCase): string {\n    // Verwende document_url falls vorhanden, sonst Suchlink\n    if (legalCase.document_url) {\n      return legalCase.document_url;\n    }\n    \n    // Fallback: Suchlink basierend auf Gerichtshof und Fallnummer\n    const searchQuery = encodeURIComponent(`${legalCase.court} ${legalCase.case_number || legalCase.caseNumber || legalCase.id}`);\n    return `https://www.google.com/search?q=${searchQuery}`;\n  }\n\n  /**\n   * Prüft auf Duplikate\n   */\n  private async checkForDuplicate(extracted: ExtractedArticle): Promise<boolean> {\n    try {\n      const existingArticles = await this.storage.getAllKnowledgeArticles();\n      \n      return existingArticles.some(article => \n        article.title === extracted.title || \n        (extracted.link && extracted.link !== '' && \n         article.content && article.content.includes(extracted.link))\n      );\n    } catch (error) {\n      logger.warn('Failed to check for duplicates', { error });\n      return false; // Im Zweifel erlauben wir die Erstellung\n    }\n  }\n\n  /**\n   * Erstellt einen Knowledge Article\n   */\n  private async createKnowledgeArticle(extracted: ExtractedArticle): Promise<void> {\n    const articleContent = this.generateArticleContent(extracted);\n    \n    await this.storage.addKnowledgeArticle({\n      title: extracted.title,\n      content: articleContent,\n      category: extracted.category,\n      tags: this.generateTags(extracted),\n      author: 'System - Automated Extraction',\n      isPublished: false // Startet als Entwurf für Review\n    });\n  }\n\n  /**\n   * Generiert Artikel-Inhalt\n   */\n  private generateArticleContent(extracted: ExtractedArticle): string {\n    return `# ${extracted.title}\n\n**Quelle:** ${extracted.source}  \n**Region:** ${extracted.region}  \n**Typ:** ${extracted.sourceType === 'regulatory' ? 'Regulatorisches Update' : 'Rechtsfall'}  \n**Kategorie:** ${extracted.category}  \n**Extrahiert am:** ${extracted.extractedAt.toLocaleDateString('de-DE')}\n\n## Originalquelle\n[Zum Originaldokument](${extracted.link})\n\n## Zusammenfassung\n*Dieser Artikel wurde automatisch aus den Datenquellen extrahiert und erfordert eine manuelle Überprüfung und Ergänzung.*\n\n---\n*Automatisch generiert am ${extracted.extractedAt.toISOString()}*`;\n  }\n\n  /**\n   * Generiert Tags für den Artikel\n   */\n  private generateTags(extracted: ExtractedArticle): string[] {\n    const tags: string[] = [\n      extracted.sourceType,\n      extracted.region,\n      extracted.category,\n      'auto-extracted',\n      'needs-review'\n    ];\n\n    // Zusätzliche Tags basierend auf dem Titel\n    const title = extracted.title.toLowerCase();\n    if (title.includes('software')) tags.push('software');\n    if (title.includes('clinical')) tags.push('clinical-trials');\n    if (title.includes('fda')) tags.push('fda');\n    if (title.includes('ema')) tags.push('ema');\n    if (title.includes('mhra')) tags.push('mhra');\n    if (title.includes('guidance')) tags.push('guidance');\n    if (title.includes('recall')) tags.push('recall');\n\n    return Array.from(new Set(tags)); // Duplikate entfernen\n  }\n\n  /**\n   * Führt Statistiken zusammen\n   */\n  private mergeStats(target: ArticleExtractionStats, source: Partial<ArticleExtractionStats>): void {\n    target.totalProcessed += source.totalProcessed || 0;\n    target.articlesExtracted += source.articlesExtracted || 0;\n    target.duplicatesSkipped += source.duplicatesSkipped || 0;\n    target.errorsEncountered += source.errorsEncountered || 0;\n    target.sourcesProcessed.push(...(source.sourcesProcessed || []));\n  }\n\n  /**\n   * Extrahiert Artikel aus spezifischen Datenquellen\n   */\n  async extractFromSpecificSources(sourceIds: string[]): Promise<ArticleExtractionStats> {\n    logger.info('Extracting articles from specific sources', { sourceIds });\n    \n    const stats: ArticleExtractionStats = {\n      totalProcessed: 0,\n      articlesExtracted: 0,\n      duplicatesSkipped: 0,\n      errorsEncountered: 0,\n      sourcesProcessed: sourceIds\n    };\n\n    // Hier könnte spezifische Logik für bestimmte Datenquellen implementiert werden\n    // Vorerst verwenden wir die allgemeine Extraktion\n    return await this.extractArticlesFromAllSources();\n  }\n}"]}