{"version":3,"file":"legalAnalysisService.js","sourceRoot":"","sources":["../../server/services/legalAnalysisService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from \"../storage\";\nimport type { LegalCase } from \"@shared/schema\";\n\ninterface LegalAnalysisResult {\n  themes: string[];\n  riskAssessment: string;\n  precedentValue: 'high' | 'medium' | 'low';\n  actionItems: string[];\n  complianceImpact: string;\n  recommendedSteps: string[];\n}\n\ninterface LegalTrendAnalysis {\n  emergingLegalTrends: string[];\n  jurisdictionActivity: { [key: string]: number };\n  riskPatterns: string[];\n  litigationTypes: { [key: string]: number };\n  preventiveRecommendations: string[];\n}\n\nexport class LegalAnalysisService {\n  \n  private legalThemes = {\n    'Produkthaftung': {\n      keywords: ['product liability', 'defective device', 'manufacturer liability', 'design defect', 'manufacturing defect'],\n      riskLevel: 'high',\n      description: 'Haftungsrisiken bei fehlerhaften Medizinprodukten'\n    },\n    'Regulatorische Compliance': {\n      keywords: ['FDA violation', 'regulatory breach', 'compliance failure', 'regulatory non-compliance', 'violation of regulation'],\n      riskLevel: 'high',\n      description: 'Verstöße gegen regulatorische Vorschriften'\n    },\n    'Klinische Studien': {\n      keywords: ['clinical trial', 'informed consent', 'ethics committee', 'clinical investigation', 'study protocol'],\n      riskLevel: 'medium',\n      description: 'Rechtliche Aspekte klinischer Prüfungen'\n    },\n    'Patente und IP': {\n      keywords: ['patent infringement', 'intellectual property', 'licensing', 'trademark', 'copyright'],\n      riskLevel: 'medium',\n      description: 'Geistiges Eigentum und Patentrechte'\n    },\n    'Datenschutz': {\n      keywords: ['GDPR', 'DSGVO', 'data protection', 'privacy', 'personal data', 'data breach'],\n      riskLevel: 'high',\n      description: 'Datenschutzrechtliche Compliance'\n    },\n    'KI/ML-Regulierung': {\n      keywords: ['artificial intelligence', 'machine learning', 'AI device', 'algorithmic bias', 'AI liability'],\n      riskLevel: 'high',\n      description: 'Rechtliche Herausforderungen bei KI-basierten Medizinprodukten'\n    },\n    'Cybersecurity': {\n      keywords: ['cybersecurity', 'data breach', 'security vulnerability', 'cyber attack', 'data security'],\n      riskLevel: 'high',\n      description: 'IT-Sicherheit und Cyber-Bedrohungen'\n    },\n    'Marktüberwachung': {\n      keywords: ['post-market surveillance', 'market surveillance', 'recall', 'corrective action', 'field safety notice'],\n      riskLevel: 'medium',\n      description: 'Marktüberwachung und Rückrufmaßnahmen'\n    }\n  };\n\n  private jurisdictions = {\n    'US': ['united states', 'usa', 'fda', 'america'],\n    'EU': ['european union', 'europe', 'ema', 'mdr', 'ce mark'],\n    'DE': ['germany', 'deutschland', 'bfarm', 'german'],\n    'UK': ['united kingdom', 'britain', 'mhra', 'british'],\n    'CH': ['switzerland', 'swissmedic', 'swiss'],\n    'CA': ['canada', 'health canada', 'canadian'],\n    'AU': ['australia', 'tga', 'australian'],\n    'JP': ['japan', 'pmda', 'japanese']\n  };\n\n  async analyzeLegalCase(legalCase: LegalCase): Promise<LegalAnalysisResult> {\n    try {\n      const fullText = `${legalCase.title} ${legalCase.summary} ${legalCase.keyIssues?.join(' ') || ''}`.toLowerCase();\n      \n      const themes: string[] = [];\n      let riskAssessment = 'Mittleres Risiko';\n      let precedentValue: 'high' | 'medium' | 'low' = 'medium';\n      const actionItems: string[] = [];\n      const recommendedSteps: string[] = [];\n\n      // Analyze legal themes\n      let maxRiskLevel = 'low';\n      for (const [theme, data] of Object.entries(this.legalThemes)) {\n        if (data.keywords.some(keyword => fullText.includes(keyword.toLowerCase()))) {\n          themes.push(theme);\n          if (data.riskLevel === 'high') {\n            maxRiskLevel = 'high';\n            precedentValue = 'high';\n          } else if (data.riskLevel === 'medium' && maxRiskLevel !== 'high') {\n            maxRiskLevel = 'medium';\n            if (precedentValue === 'low') precedentValue = 'medium';\n          }\n        }\n      }\n\n      // Determine risk assessment based on themes\n      if (maxRiskLevel === 'high') {\n        riskAssessment = 'Hohes Risiko - Sofortige Maßnahmen erforderlich';\n        actionItems.push('Sofortige rechtliche Bewertung durch Fachanwalt');\n        actionItems.push('Prüfung der Auswirkungen auf aktuelle Produkte');\n        actionItems.push('Risikobewertung für ähnliche Technologien');\n        recommendedSteps.push('Externe Rechtsberatung einbeziehen');\n        recommendedSteps.push('Compliance-Audit durchführen');\n      } else if (maxRiskLevel === 'medium') {\n        riskAssessment = 'Mittleres Risiko - Regelmäßige Überwachung erforderlich';\n        actionItems.push('Entwicklungen verfolgen und dokumentieren');\n        actionItems.push('Interne Compliance-Prüfung einleiten');\n        recommendedSteps.push('Vierteljährliche Bewertung einrichten');\n        recommendedSteps.push('Präventive Maßnahmen evaluieren');\n      } else {\n        riskAssessment = 'Geringes Risiko - Zur Kenntnisnahme';\n        actionItems.push('Archivierung für zukünftige Referenz');\n        recommendedSteps.push('Jährliche Überprüfung der Relevanz');\n      }\n\n      // Theme-specific recommendations\n      if (themes.includes('Produkthaftung')) {\n        recommendedSteps.push('Produkthaftungsversicherung überprüfen');\n        recommendedSteps.push('Design- und Fertigungsprozesse evaluieren');\n      }\n\n      if (themes.includes('KI/ML-Regulierung')) {\n        recommendedSteps.push('KI-Governance-Framework entwickeln');\n        recommendedSteps.push('Algorithmus-Transparenz verbessern');\n      }\n\n      if (themes.includes('Datenschutz')) {\n        recommendedSteps.push('DSGVO-Compliance überprüfen');\n        recommendedSteps.push('Privacy Impact Assessment durchführen');\n      }\n\n      if (themes.includes('Cybersecurity')) {\n        recommendedSteps.push('IT-Sicherheitsaudit beauftragen');\n        recommendedSteps.push('Incident Response Plan aktualisieren');\n      }\n\n      // Determine compliance impact\n      const complianceImpact = this.determineComplianceImpact(themes, legalCase.jurisdiction);\n\n      return {\n        themes: themes.length > 0 ? themes : ['Allgemein'],\n        riskAssessment,\n        precedentValue,\n        actionItems,\n        complianceImpact,\n        recommendedSteps\n      };\n    } catch (error) {\n      console.error(\"Error analyzing legal case:\", error);\n      return {\n        themes: ['Analysefehler'],\n        riskAssessment: 'Manuelle Überprüfung erforderlich',\n        precedentValue: 'medium',\n        actionItems: ['Detaillierte manuelle Analyse durchführen'],\n        complianceImpact: 'Unbekannt - manuelle Bewertung erforderlich',\n        recommendedSteps: ['Externes Rechtsgutachten einholen']\n      };\n    }\n  }\n\n  private determineComplianceImpact(themes: string[], jurisdiction?: string): string {\n    let impact = 'Gering';\n    \n    if (themes.includes('Regulatorische Compliance') || themes.includes('Produkthaftung')) {\n      impact = 'Hoch - Direkte Auswirkungen auf Zulassungsverfahren möglich';\n    } else if (themes.includes('KI/ML-Regulierung') || themes.includes('Datenschutz')) {\n      impact = 'Mittel - Präventive Maßnahmen empfohlen';\n    } else if (themes.includes('Cybersecurity') || themes.includes('Marktüberwachung')) {\n      impact = 'Mittel - Überprüfung bestehender Prozesse erforderlich';\n    }\n\n    if (jurisdiction) {\n      impact += ` (Jurisdiktion: ${jurisdiction})`;\n    }\n\n    return impact;\n  }\n\n  async analyzeLegalTrends(legalCases: LegalCase[]): Promise<LegalTrendAnalysis> {\n    try {\n      const emergingLegalTrends: string[] = [];\n      const jurisdictionActivity: { [key: string]: number } = {};\n      const riskPatterns: string[] = [];\n      const litigationTypes: { [key: string]: number } = {};\n      const preventiveRecommendations: string[] = [];\n\n      // Analyze recent cases (last 6 months)\n      const sixMonthsAgo = new Date();\n      sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n      \n      const recentCases = legalCases.filter(legalCase => {\n        const caseDate = new Date(legalCase.publishedAt);\n        return caseDate > sixMonthsAgo;\n      });\n\n      // Count by jurisdiction\n      for (const legalCase of recentCases) {\n        if (legalCase.jurisdiction) {\n          jurisdictionActivity[legalCase.jurisdiction] = (jurisdictionActivity[legalCase.jurisdiction] || 0) + 1;\n        }\n      }\n\n      // Analyze themes and trends\n      const themeCount: { [key: string]: number } = {};\n      \n      for (const legalCase of recentCases) {\n        const analysis = await this.analyzeLegalCase(legalCase);\n        \n        for (const theme of analysis.themes) {\n          themeCount[theme] = (themeCount[theme] || 0) + 1;\n          litigationTypes[theme] = (litigationTypes[theme] || 0) + 1;\n        }\n      }\n\n      // Identify emerging trends\n      const sortedThemes = Object.entries(themeCount).sort(([,a], [,b]) => b - a);\n      \n      if (sortedThemes.length > 0) {\n        const topTheme = sortedThemes[0];\n        if (topTheme[1] > 3) {\n          emergingLegalTrends.push(`Zunahme von ${topTheme[0]}-Fällen (${topTheme[1]} Fälle)`);\n        }\n      }\n\n      // Specific trend analysis\n      const aiCases = recentCases.filter(c => \n        c.title.toLowerCase().includes('ai') || \n        c.summary.toLowerCase().includes('artificial intelligence') ||\n        c.keyIssues?.some(issue => issue.toLowerCase().includes('machine learning'))\n      );\n\n      if (aiCases.length > 2) {\n        emergingLegalTrends.push('Verstärkte Regulierung von KI-basierten Medizinprodukten');\n        preventiveRecommendations.push('KI-Governance und Ethik-Richtlinien entwickeln');\n      }\n\n      const cyberCases = recentCases.filter(c => \n        c.title.toLowerCase().includes('cyber') || \n        c.summary.toLowerCase().includes('data breach')\n      );\n\n      if (cyberCases.length > 1) {\n        emergingLegalTrends.push('Erhöhte Cybersecurity-Litigation');\n        preventiveRecommendations.push('IT-Sicherheitsmaßnahmen verstärken');\n      }\n\n      const gdprCases = recentCases.filter(c => \n        c.title.toLowerCase().includes('gdpr') || \n        c.summary.toLowerCase().includes('data protection')\n      );\n\n      if (gdprCases.length > 1) {\n        emergingLegalTrends.push('Verstärkte Datenschutz-Enforcement');\n        preventiveRecommendations.push('DSGVO-Compliance überprüfen und verstärken');\n      }\n\n      // Risk pattern analysis\n      const highRiskCases = recentCases.filter(async c => {\n        const analysis = await this.analyzeLegalCase(c);\n        return analysis.precedentValue === 'high';\n      });\n\n      if (highRiskCases.length > recentCases.length * 0.3) {\n        riskPatterns.push('Erhöhte Anzahl von High-Impact Rechtsfällen');\n      }\n\n      // Most active jurisdiction\n      const mostActiveJurisdiction = Object.entries(jurisdictionActivity)\n        .sort(([,a], [,b]) => b - a)[0];\n\n      if (mostActiveJurisdiction && mostActiveJurisdiction[1] > 2) {\n        emergingLegalTrends.push(`Erhöhte Rechtsaktivität in ${mostActiveJurisdiction[0]}`);\n        preventiveRecommendations.push(`${mostActiveJurisdiction[0]}-spezifische Compliance-Strategie entwickeln`);\n      }\n\n      // General recommendations based on trends\n      if (emergingLegalTrends.length > 2) {\n        preventiveRecommendations.push('Quartalsmäßige Legal Risk Assessments implementieren');\n        preventiveRecommendations.push('Proaktive Stakeholder-Kommunikation bei Rechtsänderungen');\n      }\n\n      return {\n        emergingLegalTrends,\n        jurisdictionActivity,\n        riskPatterns,\n        litigationTypes,\n        preventiveRecommendations\n      };\n    } catch (error) {\n      console.error(\"Error analyzing legal trends:\", error);\n      return {\n        emergingLegalTrends: ['Trendanalyse nicht verfügbar'],\n        jurisdictionActivity: {},\n        riskPatterns: ['Manuelle Risikoanalyse erforderlich'],\n        litigationTypes: {},\n        preventiveRecommendations: ['Externe Rechtsberatung für Trendanalyse einholen']\n      };\n    }\n  }\n\n  async generateComplianceReport(themes: string[], jurisdiction: string): Promise<{\n    riskLevel: 'high' | 'medium' | 'low';\n    specificRequirements: string[];\n    actionPlan: string[];\n    timeline: string;\n  }> {\n    let riskLevel: 'high' | 'medium' | 'low' = 'low';\n    const specificRequirements: string[] = [];\n    const actionPlan: string[] = [];\n    let timeline = '3-6 Monate';\n\n    // High-risk themes\n    if (themes.some(theme => ['Produkthaftung', 'Regulatorische Compliance', 'KI/ML-Regulierung', 'Datenschutz'].includes(theme))) {\n      riskLevel = 'high';\n      timeline = '1-3 Monate';\n    } else if (themes.some(theme => ['Cybersecurity', 'Marktüberwachung', 'Klinische Studien'].includes(theme))) {\n      riskLevel = 'medium';\n      timeline = '2-4 Monate';\n    }\n\n    // Jurisdiction-specific requirements\n    switch (jurisdiction.toUpperCase()) {\n      case 'EU':\n        specificRequirements.push('MDR-Compliance überprüfen');\n        specificRequirements.push('CE-Kennzeichnung validieren');\n        specificRequirements.push('DSGVO-Konformität sicherstellen');\n        actionPlan.push('Benannte Stelle konsultieren');\n        break;\n      case 'US':\n        specificRequirements.push('FDA-Registrierung überprüfen');\n        specificRequirements.push('510(k) oder PMA-Status validieren');\n        specificRequirements.push('QSR-Compliance sicherstellen');\n        actionPlan.push('FDA-Beratung beantragen');\n        break;\n      case 'DE':\n        specificRequirements.push('BfArM-Richtlinien befolgen');\n        specificRequirements.push('DiGA-Kriterien prüfen (falls zutreffend)');\n        actionPlan.push('Deutsche Rechtexperten konsultieren');\n        break;\n    }\n\n    // Theme-specific action plans\n    if (themes.includes('KI/ML-Regulierung')) {\n      actionPlan.push('KI-Ethik-Komitee einrichten');\n      actionPlan.push('Algorithmus-Auditierung implementieren');\n    }\n\n    if (themes.includes('Cybersecurity')) {\n      actionPlan.push('Penetration Testing durchführen');\n      actionPlan.push('ISO 27001 Zertifizierung anstreben');\n    }\n\n    return {\n      riskLevel,\n      specificRequirements,\n      actionPlan,\n      timeline\n    };\n  }\n\n  async extractKeyLegalPrinciples(caseText: string): Promise<{\n    principles: string[];\n    precedents: string[];\n    implications: string[];\n  }> {\n    const principles: string[] = [];\n    const precedents: string[] = [];\n    const implications: string[] = [];\n\n    const lowerText = caseText.toLowerCase();\n\n    // Extract legal principles\n    if (lowerText.includes('duty of care') || lowerText.includes('sorgfaltspflicht')) {\n      principles.push('Sorgfaltspflicht des Herstellers');\n      implications.push('Erhöhte Dokumentations- und Qualitätssicherungsanforderungen');\n    }\n\n    if (lowerText.includes('informed consent') || lowerText.includes('aufklärungspflicht')) {\n      principles.push('Informed Consent bei klinischen Studien');\n      implications.push('Verstärkte Aufklärungs- und Dokumentationspflichten');\n    }\n\n    if (lowerText.includes('regulatory compliance') || lowerText.includes('regulatorische compliance')) {\n      principles.push('Strikte Einhaltung regulatorischer Vorgaben');\n      implications.push('Kontinuierliche Überwachung von Regulierungsänderungen erforderlich');\n    }\n\n    if (lowerText.includes('data protection') || lowerText.includes('datenschutz')) {\n      principles.push('Datenschutz als Grundrecht');\n      implications.push('Privacy by Design in Produktentwicklung integrieren');\n    }\n\n    // Extract precedents\n    if (lowerText.includes('landmark case') || lowerText.includes('precedent')) {\n      precedents.push('Präzedenzfall für ähnliche Technologien');\n    }\n\n    if (lowerText.includes('class action') || lowerText.includes('sammelklage')) {\n      precedents.push('Potenzial für Sammelklagen bei ähnlichen Problemen');\n    }\n\n    return {\n      principles,\n      precedents,\n      implications\n    };\n  }\n}\n\nexport const legalAnalysisService = new LegalAnalysisService();"]}