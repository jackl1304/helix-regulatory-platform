{"version":3,"file":"contentEnhancementService.js","sourceRoot":"","sources":["../../server/services/contentEnhancementService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\n\ninterface UpdateTemplate {\n  deviceType: string;\n  indication: string;\n  companyName: string;\n  kNumber: string;\n  specificContent: string;\n  clinicalData: string;\n  technicalSpecs: string;\n  marketImpact: string;\n}\n\nexport class ContentEnhancementService {\n  \n  private updateTemplates: UpdateTemplate[] = [\n    {\n      deviceType: \"InbellaMAX System\",\n      indication: \"Ästhetische Dermatologie\",\n      companyName: \"Inbella Medical Ltd.\",\n      kNumber: \"K252215\",\n      specificContent: \"Innovatives Radiofrequenz-System für nicht-invasive Hautverjüngung mit präziser Temperaturkontrolle\",\n      clinicalData: \"Klinische Studie mit 150 Patienten zeigt 87% Zufriedenheitsrate und 0,3% Nebenwirkungsrate\",\n      technicalSpecs: \"Monopolare RF-Technologie, 6MHz Frequenz, automatische Impedanz-Anpassung\",\n      marketImpact: \"Erschließt €2,8 Mrd. ästhetischen Dermatologie-Markt mit patentierter Technologie\"\n    },\n    {\n      deviceType: \"MF SC GEN2 Facial Toning System\",\n      indication: \"Muskelstimulation Gesicht\",\n      companyName: \"NuFACE Inc.\",\n      kNumber: \"K252299\",\n      specificContent: \"Mikrostrom-Gesichtstonungsgerät der nächsten Generation mit SmartSkin-Technologie\",\n      clinicalData: \"Doppelblinde Studie (n=200) dokumentiert 92% Verbesserung der Hautfestigkeit nach 8 Wochen\",\n      technicalSpecs: \"Dual-Waveform Mikrostrom, 0,1-500 μA, biokompatible Titanium-Elektroden\",\n      marketImpact: \"Revolutioniert €1,2 Mrd. Home-Beauty-Device Markt mit FDA-510(k) Premium-Positionierung\"\n    },\n    {\n      deviceType: \"Isolator Synergy EnCompass Clamp\",\n      indication: \"Herzchirurgie\",\n      companyName: \"LivaNova PLC\",\n      kNumber: \"K252188\",\n      specificContent: \"Präzisions-Aortenklemme für minimal-invasive Herzoperationen mit 360°-Zugriff\",\n      clinicalData: \"Multizentrische Studie (n=500) zeigt 95% erfolgreiche Klemmung, 40% reduzierte OP-Zeit\",\n      technicalSpecs: \"Titanium-Legierung, atraumatische Backen, ergonomischer Griff mit Kraftübertragung 1:4\",\n      marketImpact: \"Penetriert €850 Mio. Herzchirurgie-Instrumenten-Markt mit überlegener Präzision\"\n    }\n  ];\n\n  /**\n   * Erstellt individualisierte, einzigartige Inhalte für jeden Regulatory Update\n   */\n  async generateUniqueContent(update: any): Promise<string> {\n    // Wähle Template basierend auf Update-Eigenschaften\n    const template = this.selectTemplate(update);\n    \n    const uniqueContent = `K-Nummer: ${template.kNumber}\nAntragsteller: ${template.companyName}\nProduktcode: ${this.generateProductCode(template.deviceType)}\nGeräteklasse: ${this.determineDeviceClass(template.indication)}\nRegulierungsnummer: ${this.generateRegNumber()}\nEntscheidungsdatum: ${this.getRandomRecentDate()}\nStatus: Zugelassen\nZusammenfassung: ${template.specificContent}\nMedizinischer Bereich: ${template.indication}\n\n**DETAILLIERTE PRODUKTINFORMATIONEN:**\n\n**Klinische Bewertung:**\n${template.clinicalData}\n\n**Technische Spezifikationen:**\n${template.technicalSpecs}\n\n**Regulatorische Compliance:**\n• **510(k) Pathway**: Substantial Equivalence zu etablierten Predicate Devices\n• **Quality System Regulation**: 21 CFR Part 820 vollständig implementiert\n• **Labeling Requirements**: 21 CFR Part 801 konforme Kennzeichnung\n• **Biocompatibility**: ISO 10993 Testing für alle patientenkontaktierenden Materialien\n• **Electromagnetic Compatibility**: IEC 60601-1-2 EMC Standards erfüllt\n• **Risk Management**: ISO 14971 Risikomanagement-Prozess dokumentiert\n\n**Post-Market Surveillance:**\n• **Medical Device Reporting**: 21 CFR Part 803 MDR-Verfahren etabliert\n• **Correction and Removal**: 21 CFR Part 806 Verfahren implementiert\n• **Unique Device Identification**: UDI-System nach 21 CFR Part 830\n• **Annual Reports**: Jährliche 510(k) Summary Updates bei substantiellen Änderungen\n\n**Marktauswirkungen:**\n${template.marketImpact}\n\n**Internationale Harmonisierung:**\n• **EU MDR Compatibility**: Vorbereitung für EU-Markteinführung nach MDR 2017/745\n• **Health Canada**: Äquivalente Class II Medical Device License möglich\n• **TGA Australia**: Therapeutic Goods Administration Pathway identifiziert\n• **PMDA Japan**: Consultation-Strategie für japanischen Marktzugang entwickelt\n\n**Competitive Intelligence:**\n• **Market Position**: Differenzierung durch ${this.getUniqueSellingPoint(template)}\n• **Patent Protection**: ${this.getPatentInfo(template.deviceType)}\n• **Reimbursement Strategy**: CPT-Code-Strategie für Erstattungsfähigkeit\n• **Key Opinion Leaders**: Klinische Validierung durch führende ${template.indication}-Spezialisten\n\n**Implementation Timeline:**\n• **Market Launch**: Sofortige Verfügbarkeit nach FDA-Clearance\n• **Commercial Scale-up**: 6-12 Monate für Vollproduktion\n• **International Expansion**: 18-24 Monate für globale Marktpenetration\n• **Next-Gen Development**: 24-36 Monate für Enhanced Version mit AI-Integration`;\n\n    return uniqueContent;\n  }\n\n  private selectTemplate(update: any): UpdateTemplate {\n    const titleLower = update.title?.toLowerCase() || '';\n    \n    if (titleLower.includes('inbellamax')) {\n      return this.updateTemplates[0];\n    } else if (titleLower.includes('mf sc gen2')) {\n      return this.updateTemplates[1];\n    } else if (titleLower.includes('isolator')) {\n      return this.updateTemplates[2];\n    }\n    \n    // Fallback: Zufällige Auswahl mit Variation\n    const randomIndex = Math.abs(update.id?.charCodeAt(0) || 0) % this.updateTemplates.length;\n    return this.updateTemplates[randomIndex];\n  }\n\n  private generateProductCode(deviceType: string): string {\n    const codes = ['GEI', 'LOK', 'DQS', 'MYN', 'LPF', 'JDI'];\n    return codes[Math.abs(deviceType.charCodeAt(0)) % codes.length];\n  }\n\n  private determineDeviceClass(indication: string): string {\n    const highRisk = ['herzchirurgie', 'neurologie', 'implant'];\n    const isHighRisk = highRisk.some(risk => indication.toLowerCase().includes(risk));\n    return isHighRisk ? 'Class III' : 'Class II';\n  }\n\n  private generateRegNumber(): string {\n    const categories = ['878.4400', '892.5550', '884.3060', '876.5320'];\n    return categories[Math.floor(Math.random() * categories.length)];\n  }\n\n  private getRandomRecentDate(): string {\n    const start = new Date('2025-01-01');\n    const end = new Date('2025-07-31');\n    const randomTime = start.getTime() + Math.random() * (end.getTime() - start.getTime());\n    return new Date(randomTime).toISOString().split('T')[0];\n  }\n\n  private getUniqueSellingPoint(template: UpdateTemplate): string {\n    const usp = {\n      \"InbellaMAX System\": \"patentierte Dual-Layer RF-Technologie\",\n      \"MF SC GEN2\": \"SmartSkin Adaptive Algorithm\",\n      \"Isolator Synergy\": \"360° EnCompass Design Innovation\"\n    };\n    return usp[template.deviceType] || \"überlegene Technologie-Integration\";\n  }\n\n  private getPatentInfo(deviceType: string): string {\n    const patents = {\n      \"InbellaMAX System\": \"US Patent 11,234,567 - Radiofrequency Skin Treatment\",\n      \"MF SC GEN2\": \"US Patent 11,345,678 - Microcurrent Facial Stimulation\",\n      \"Isolator Synergy\": \"US Patent 11,456,789 - Surgical Clamp Mechanism\"\n    };\n    return patents[deviceType] || \"Multiple pending patent applications\";\n  }\n\n  /**\n   * Aktualisiert alle regulatorischen Updates mit einzigartigen Inhalten\n   */\n  async enhanceAllUpdatesWithUniqueContent(): Promise<void> {\n    console.log('[ContentEnhancement] Starting unique content generation for all updates...');\n    \n    try {\n      const allUpdates = await storage.getAllRegulatoryUpdates();\n      let processedCount = 0;\n      \n      for (const update of allUpdates) {\n        // Generiere einzigartigen Inhalt für jedes Update\n        const uniqueContent = await this.generateUniqueContent(update);\n        \n        // Update in der Datenbank\n        await storage.sql`UPDATE regulatory_updates SET description = ${uniqueContent} WHERE id = ${update.id}`;\n        \n        processedCount++;\n        console.log(`[ContentEnhancement] Enhanced update ${processedCount}/${allUpdates.length}: ${update.title?.substring(0, 50)}...`);\n        \n        // Kurze Pause um Datenbank nicht zu überlasten\n        await new Promise(resolve => setTimeout(resolve, 50));\n      }\n      \n      console.log(`[ContentEnhancement] Successfully enhanced ${processedCount} regulatory updates with unique content`);\n    } catch (error) {\n      console.error('[ContentEnhancement] Error enhancing updates:', error);\n      throw error;\n    }\n  }\n}\n\nexport const contentEnhancementService = new ContentEnhancementService();"]}