{"version":3,"file":"enhancedLegalAnalysisService.js","sourceRoot":"","sources":["../../server/services/enhancedLegalAnalysisService.ts"],"names":[],"mappings":"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","sourcesContent":["import { storage } from '../storage';\nimport type { LegalCase } from '@shared/schema';\n\ninterface LegalTheme {\n  id: string;\n  name: string;\n  description: string;\n  keywords: string[];\n  relatedCases: string[];\n  precedentValue: 'high' | 'medium' | 'low';\n  jurisdiction: string[];\n  category: string;\n}\n\ninterface CaseRelationship {\n  caseId1: string;\n  caseId2: string;\n  relationshipType: 'precedent' | 'similar_facts' | 'conflicting' | 'citing' | 'overturned';\n  strength: number; // 0-1\n  explanation: string;\n}\n\ninterface LegalAnalysis {\n  themes: LegalTheme[];\n  relationships: CaseRelationship[];\n  precedentChains: Array<{\n    theme: string;\n    cases: string[];\n    development: string;\n  }>;\n  conflictingDecisions: Array<{\n    issue: string;\n    cases: Array<{\n      caseId: string;\n      position: string;\n      jurisdiction: string;\n    }>;\n  }>;\n}\n\ninterface LegalTrendAnalysis {\n  emergingTrends: string[];\n  jurisdictionActivity: { [key: string]: number };\n  riskPatterns: string[];\n  litigationTypes: { [key: string]: number };\n  preventiveRecommendations: string[];\n}\n\nexport class EnhancedLegalAnalysisService {\n  private themes: LegalTheme[] = [\n    {\n      id: \"product_liability\",\n      name: \"Produkthaftung bei Medizinprodukten\",\n      description: \"Haftung des Herstellers für Schäden durch defekte Medizinprodukte\",\n      keywords: [\"product liability\", \"defective device\", \"manufacturer liability\", \"Produkthaftung\", \"Herstellerhaftung\"],\n      relatedCases: [],\n      precedentValue: \"high\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\"],\n      category: \"Liability\"\n    },\n    {\n      id: \"regulatory_compliance\",\n      name: \"Regulatorische Compliance-Verletzungen\",\n      description: \"Verstöße gegen FDA, EMA oder andere regulatorische Anforderungen\",\n      keywords: [\"FDA violation\", \"regulatory breach\", \"compliance failure\", \"EMA non-compliance\", \"Zulassungsverstoß\"],\n      relatedCases: [],\n      precedentValue: \"high\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\", \"CH\"],\n      category: \"Regulatory\"\n    },\n    {\n      id: \"clinical_trial_issues\",\n      name: \"Klinische Studien und Ethik\",\n      description: \"Probleme bei klinischen Studien, Einverständnis, Ethikkommissionen\",\n      keywords: [\"clinical trial\", \"informed consent\", \"ethics committee\", \"klinische Studie\", \"Aufklärung\"],\n      relatedCases: [],\n      precedentValue: \"medium\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\", \"CH\"],\n      category: \"Clinical\"\n    },\n    {\n      id: \"patent_ip\",\n      name: \"Patente und geistiges Eigentum\",\n      description: \"Patentstreitigkeiten, Lizenzierung, geistiges Eigentum bei Medizinprodukten\",\n      keywords: [\"patent infringement\", \"intellectual property\", \"licensing\", \"Patentverletzung\", \"Lizenzierung\"],\n      relatedCases: [],\n      precedentValue: \"medium\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\", \"CH\"],\n      category: \"IP\"\n    },\n    {\n      id: \"market_access\",\n      name: \"Marktzugang und Erstattung\",\n      description: \"Streitigkeiten um Marktzulassung, Preisgestaltung, Erstattung\",\n      keywords: [\"market access\", \"reimbursement\", \"pricing\", \"Marktzugang\", \"Erstattung\"],\n      relatedCases: [],\n      precedentValue: \"medium\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\", \"CH\"],\n      category: \"Market Access\"\n    },\n    {\n      id: \"data_privacy\",\n      name: \"Datenschutz und Medizindaten\",\n      description: \"GDPR/DSGVO Compliance, Patientendatenschutz, Cybersecurity\",\n      keywords: [\"GDPR\", \"DSGVO\", \"data protection\", \"patient privacy\", \"Datenschutz\"],\n      relatedCases: [],\n      precedentValue: \"high\",\n      jurisdiction: [\"EU\", \"DE\", \"UK\", \"CH\"],\n      category: \"Privacy\"\n    },\n    {\n      id: \"ai_ml_devices\",\n      name: \"KI/ML-basierte Medizinprodukte\",\n      description: \"Rechtliche Fragen zu künstlicher Intelligenz und maschinellem Lernen\",\n      keywords: [\"artificial intelligence\", \"machine learning\", \"AI device\", \"KI-Medizinprodukt\", \"algorithm\"],\n      relatedCases: [],\n      precedentValue: \"high\",\n      jurisdiction: [\"US\", \"EU\", \"DE\", \"UK\"],\n      category: \"AI/ML\"\n    }\n  ];\n\n  async analyzeLegalCases(cases: LegalCase[]): Promise<LegalAnalysis> {\n    console.log(`[Enhanced Legal Analysis] Analyzing ${cases.length} legal cases for themes and relationships...`);\n\n    const analysis: LegalAnalysis = {\n      themes: [],\n      relationships: [],\n      precedentChains: [],\n      conflictingDecisions: []\n    };\n\n    // 1. Kategorisiere Fälle nach Themen\n    for (const theme of this.themes) {\n      const relatedCases = this.findCasesForTheme(cases, theme);\n      if (relatedCases.length > 0) {\n        theme.relatedCases = relatedCases.map(c => c.id);\n        analysis.themes.push({\n          ...theme,\n          relatedCases: theme.relatedCases\n        });\n      }\n    }\n\n    // 2. Finde Beziehungen zwischen Fällen\n    analysis.relationships = this.findCaseRelationships(cases);\n\n    // 3. Erstelle Präzedenzfallketten\n    analysis.precedentChains = this.buildPrecedentChains(cases, analysis.relationships);\n\n    // 4. Identifiziere widersprüchliche Entscheidungen\n    analysis.conflictingDecisions = this.findConflictingDecisions(cases, analysis.themes);\n\n    console.log(`[Enhanced Legal Analysis] Analysis complete: ${analysis.themes.length} themes, ${analysis.relationships.length} relationships`);\n    return analysis;\n  }\n\n  async analyzeLegalTrends(cases: LegalCase[], timeframe: 'quarterly' | 'yearly' = 'yearly'): Promise<LegalTrendAnalysis> {\n    console.log(`[Enhanced Legal Analysis] Analyzing legal trends (${timeframe})...`);\n\n    const cutoffDate = new Date();\n    if (timeframe === 'quarterly') {\n      cutoffDate.setMonth(cutoffDate.getMonth() - 3);\n    } else {\n      cutoffDate.setFullYear(cutoffDate.getFullYear() - 1);\n    }\n\n    const recentCases = cases.filter(c => new Date(c.decisionDate || c.filingDate) >= cutoffDate);\n\n    const trends: LegalTrendAnalysis = {\n      emergingTrends: this.identifyEmergingTrends(recentCases),\n      jurisdictionActivity: this.analyzeJurisdictionActivity(recentCases),\n      riskPatterns: this.identifyRiskPatterns(recentCases),\n      litigationTypes: this.analyzeLitigationTypes(recentCases),\n      preventiveRecommendations: this.generatePreventiveRecommendations(recentCases)\n    };\n\n    console.log(`[Enhanced Legal Analysis] Trend analysis complete for ${recentCases.length} recent cases`);\n    return trends;\n  }\n\n  private findCasesForTheme(cases: LegalCase[], theme: LegalTheme): LegalCase[] {\n    return cases.filter(case_ => {\n      const searchText = `${case_.caseTitle} ${case_.summary} ${case_.keyIssues.join(' ')}`.toLowerCase();\n      \n      return theme.keywords.some(keyword => \n        searchText.includes(keyword.toLowerCase())\n      );\n    });\n  }\n\n  private findCaseRelationships(cases: LegalCase[]): CaseRelationship[] {\n    const relationships: CaseRelationship[] = [];\n\n    for (let i = 0; i < cases.length; i++) {\n      for (let j = i + 1; j < cases.length; j++) {\n        const case1 = cases[i];\n        const case2 = cases[j];\n\n        const relationship = this.analyzeCaseRelationship(case1, case2);\n        if (relationship.strength > 0.3) { // Nur signifikante Beziehungen\n          relationships.push(relationship);\n        }\n      }\n    }\n\n    return relationships.sort((a, b) => b.strength - a.strength);\n  }\n\n  private analyzeCaseRelationship(case1: LegalCase, case2: LegalCase): CaseRelationship {\n    let strength = 0;\n    let relationshipType: CaseRelationship['relationshipType'] = 'similar_facts';\n    let explanation = '';\n\n    // Prüfe auf gemeinsame Themen\n    const commonIssues = case1.keyIssues.filter(issue => \n      case2.keyIssues.some(issue2 => \n        issue.toLowerCase().includes(issue2.toLowerCase()) || \n        issue2.toLowerCase().includes(issue.toLowerCase())\n      )\n    );\n\n    strength += commonIssues.length * 0.2;\n\n    // Prüfe auf Zitierungen\n    if (case1.summary.toLowerCase().includes(case2.caseTitle.toLowerCase()) ||\n        case2.summary.toLowerCase().includes(case1.caseTitle.toLowerCase())) {\n      relationshipType = 'citing';\n      strength += 0.4;\n      explanation = 'One case cites the other as precedent';\n    }\n\n    // Prüfe auf ähnliche rechtliche Grundlagen\n    if (case1.legalBasis && case2.legalBasis) {\n      const basis1 = case1.legalBasis.toLowerCase();\n      const basis2 = case2.legalBasis.toLowerCase();\n      \n      if (basis1.includes(basis2) || basis2.includes(basis1)) {\n        strength += 0.3;\n        explanation = explanation || 'Cases share similar legal basis';\n      }\n    }\n\n    // Prüfe auf widersprüchliche Entscheidungen\n    if (commonIssues.length > 0 && case1.outcome !== case2.outcome) {\n      relationshipType = 'conflicting';\n      strength += 0.2;\n      explanation = 'Cases have conflicting outcomes on similar issues';\n    }\n\n    // Zeitliche Nähe\n    const date1 = new Date(case1.decisionDate || case1.filingDate);\n    const date2 = new Date(case2.decisionDate || case2.filingDate);\n    const daysDiff = Math.abs(date1.getTime() - date2.getTime()) / (1000 * 60 * 60 * 24);\n    \n    if (daysDiff < 365) {\n      strength += 0.1;\n    }\n\n    return {\n      caseId1: case1.id,\n      caseId2: case2.id,\n      relationshipType,\n      strength: Math.min(strength, 1.0),\n      explanation: explanation || 'Cases share common legal themes'\n    };\n  }\n\n  private buildPrecedentChains(cases: LegalCase[], relationships: CaseRelationship[]) {\n    const chains: Array<{ theme: string; cases: string[]; development: string }> = [];\n\n    // Gruppiere nach Themen\n    const themeGroups = new Map<string, LegalCase[]>();\n    \n    for (const theme of this.themes) {\n      const themeCases = this.findCasesForTheme(cases, theme);\n      if (themeCases.length > 1) {\n        themeGroups.set(theme.name, themeCases.sort((a, b) => \n          new Date(a.decisionDate || a.filingDate).getTime() - \n          new Date(b.decisionDate || b.filingDate).getTime()\n        ));\n      }\n    }\n\n    // Erstelle Ketten für jedes Thema\n    for (const [themeName, themeCases] of themeGroups) {\n      if (themeCases.length >= 2) {\n        chains.push({\n          theme: themeName,\n          cases: themeCases.map(c => c.id),\n          development: this.analyzeLegalDevelopment(themeCases)\n        });\n      }\n    }\n\n    return chains;\n  }\n\n  private findConflictingDecisions(cases: LegalCase[], themes: LegalTheme[]) {\n    const conflicts: Array<{\n      issue: string;\n      cases: Array<{ caseId: string; position: string; jurisdiction: string }>;\n    }> = [];\n\n    for (const theme of themes) {\n      const themeCases = this.findCasesForTheme(cases, theme);\n      \n      // Gruppiere nach Outcome\n      const outcomeGroups = new Map<string, LegalCase[]>();\n      for (const case_ of themeCases) {\n        const outcome = case_.outcome || 'unknown';\n        if (!outcomeGroups.has(outcome)) {\n          outcomeGroups.set(outcome, []);\n        }\n        outcomeGroups.get(outcome)!.push(case_);\n      }\n\n      // Identifiziere Konflikte\n      if (outcomeGroups.size > 1) {\n        const conflictCases: Array<{ caseId: string; position: string; jurisdiction: string }> = [];\n        \n        for (const [outcome, casesWithOutcome] of outcomeGroups) {\n          for (const case_ of casesWithOutcome) {\n            conflictCases.push({\n              caseId: case_.id,\n              position: outcome,\n              jurisdiction: case_.jurisdiction\n            });\n          }\n        }\n\n        if (conflictCases.length > 1) {\n          conflicts.push({\n            issue: theme.name,\n            cases: conflictCases\n          });\n        }\n      }\n    }\n\n    return conflicts;\n  }\n\n  private identifyEmergingTrends(cases: LegalCase[]): string[] {\n    const trendKeywords = [\n      'artificial intelligence', 'machine learning', 'cybersecurity', 'data protection',\n      'telemedicine', 'digital health', 'remote monitoring', 'blockchain',\n      'software as medical device', 'algorithm bias', 'privacy by design'\n    ];\n\n    const trends: Map<string, number> = new Map();\n\n    for (const case_ of cases) {\n      const caseText = `${case_.caseTitle} ${case_.summary} ${case_.keyIssues.join(' ')}`.toLowerCase();\n      \n      for (const keyword of trendKeywords) {\n        if (caseText.includes(keyword.toLowerCase())) {\n          trends.set(keyword, (trends.get(keyword) || 0) + 1);\n        }\n      }\n    }\n\n    return Array.from(trends.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([trend]) => trend);\n  }\n\n  private analyzeJurisdictionActivity(cases: LegalCase[]): { [key: string]: number } {\n    const activity: { [key: string]: number } = {};\n\n    for (const case_ of cases) {\n      const jurisdiction = case_.jurisdiction || 'Unknown';\n      activity[jurisdiction] = (activity[jurisdiction] || 0) + 1;\n    }\n\n    return activity;\n  }\n\n  private identifyRiskPatterns(cases: LegalCase[]): string[] {\n    const riskIndicators = [\n      'class action', 'punitive damages', 'regulatory violation',\n      'criminal charges', 'injunctive relief', 'recall',\n      'death', 'serious injury', 'FDA warning letter'\n    ];\n\n    const patterns: Map<string, number> = new Map();\n\n    for (const case_ of cases) {\n      const caseText = `${case_.caseTitle} ${case_.summary}`.toLowerCase();\n      \n      for (const indicator of riskIndicators) {\n        if (caseText.includes(indicator.toLowerCase())) {\n          patterns.set(indicator, (patterns.get(indicator) || 0) + 1);\n        }\n      }\n    }\n\n    return Array.from(patterns.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([pattern]) => pattern);\n  }\n\n  private analyzeLitigationTypes(cases: LegalCase[]): { [key: string]: number } {\n    const types: { [key: string]: number } = {};\n\n    for (const case_ of cases) {\n      const caseType = case_.caseType || 'Other';\n      types[caseType] = (types[caseType] || 0) + 1;\n    }\n\n    return types;\n  }\n\n  private generatePreventiveRecommendations(cases: LegalCase[]): string[] {\n    const recommendations: string[] = [];\n    \n    // Basierend auf häufigen Problemen\n    const commonIssues = new Map<string, number>();\n    \n    for (const case_ of cases) {\n      for (const issue of case_.keyIssues) {\n        commonIssues.set(issue, (commonIssues.get(issue) || 0) + 1);\n      }\n    }\n\n    const topIssues = Array.from(commonIssues.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3);\n\n    for (const [issue] of topIssues) {\n      if (issue.toLowerCase().includes('cybersecurity')) {\n        recommendations.push('Implementierung robuster Cybersecurity-Maßnahmen für alle vernetzten Medizinprodukte');\n      } else if (issue.toLowerCase().includes('clinical trial')) {\n        recommendations.push('Verstärkung der Aufklärungs- und Einverständnisprozesse bei klinischen Studien');\n      } else if (issue.toLowerCase().includes('product liability')) {\n        recommendations.push('Verbesserung der Qualitätssicherung und Post-Market-Surveillance');\n      } else if (issue.toLowerCase().includes('data protection')) {\n        recommendations.push('GDPR-konforme Datenverarbeitung und Privacy-by-Design-Ansätze');\n      } else {\n        recommendations.push(`Verstärkte Compliance-Maßnahmen bezüglich: ${issue}`);\n      }\n    }\n\n    return recommendations;\n  }\n\n  private analyzeLegalDevelopment(cases: LegalCase[]): string {\n    if (cases.length < 2) return 'Insufficient data for development analysis';\n\n    const firstCase = cases[0];\n    const lastCase = cases[cases.length - 1];\n\n    const developments: string[] = [];\n\n    if (firstCase.outcome !== lastCase.outcome) {\n      developments.push(`Rechtsprechung hat sich von \"${firstCase.outcome}\" zu \"${lastCase.outcome}\" entwickelt`);\n    }\n\n    // Weitere Entwicklungsanalyse...\n    \n    return developments.join('. ') || 'Konsistente Rechtsprechung über den Zeitraum';\n  }\n}\n\nexport const enhancedLegalAnalysisService = new EnhancedLegalAnalysisService();"]}